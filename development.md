# Установка

## Виртуальное окружение

Для создания виртуального окружения воспользуйтесь командой:
```
python -m venv venv
```

Далее активируйте его:
```
# Linux
source venv/Scripts/activate

venv/Scripts/activate
```

## Разработка с помощью Dev Container

Для комфортной разработки используется DevContainer (в VS Code):

Убедитесь, что установлены:
- **Docker**
- **VS Code**
- Расширение Dev Containers

Откройте проект в VS Code и нажмите:
```
Ctrl + Shift + P → Dev Containers: Rebuild and Reopen in Container
```

Контейнер будет собран и откроется в среде с уже установленными зависимостями.

# Запуск проекта

Запустите приложение:
```
python app/main.py
```

После запуска приложения модель предложит ввести вопрос:

```
Добро пожаловать в консольную систему анализа данных!
Введите 'выход' или 'exit', чтобы завершить работу.

 Задайте вопрос: 
```

Пример вопроса:
```
Какой средний доход у фрилансеров из Европы? 
```

После ввода и нажатия `Enter` приложение выдаст ответ на данный вопрос. Если вопрос не валиден
или не относится к данным, то модель ответит 
```
Мне не удалось получить ответ на ваш вопрос. Постарайтесь уточнить его.
```

Для выхода из программы введите 'выход' или 'exit'


## Валидация

Система поддерживает автоматическую проверку качества ответов модели.

Запуск валидации:
```
python app/run_validation.py
```

Скрипт:

- Запускает все вопросы из validate_answer.json
- Генерирует код с помощью модели
- Выполняет его
- Сравнивает результаты
- Выводит метрики точности

Подробное описание методологии оценки см. в файле REPORT.md.

Файл `validate_answer.json` составляется пользователем вручную и испольузется для сопоставления ответов модели с правильными ответами.

Файл содержит следующие поля:
```
{
    "<question>" : "<code>"
}
```
Где:
- <question> - Вопрос к данным на ЕЯ
- <code> - Python-код, который выполняет необходимые дейвствия для ответа на данный вопрос

# Структура проекта

```
.
├── app/
│   ├── main.py                # Точка входа CLI
│   ├── analyzer.py            # Основной класс DataAnalyzer
│   ├── data_load.py           # Загрузка данных
│   ├── models/
│   │   └── base_model.py      # Интерфейс модели
│   ├── prompts/
│   │   ├── loader.py          # Загрузка промптов из файлов
│   │   └── prompt_config.json # Конфиг промпта + примеры
│   └── utils.py               # Вспомогательные функции
│
├── tests/
│   ├── conftest.py            # Общие фикстуры для тестов
│   ├── test_analyzer.py       # Юнит-тесты
│   └── fixtures/
│       └── mock_responses.json # Моки ответов модели
│
├── data/
│   └── freelancer_earnings_bd.csv # Датасет
│
├── .env                        # Переменные окружения
├── Dockerfile                  # Для сборки образа
├── docker-compose.yml          # Локальный запуск в контейнере
├── Makefile                    # Утилиты для форматирования, тестирования и установки
├── pyproject.toml              # Настройки проекта (Poetry)
├── requirements.txt            # Для pip-совместимости
├── REPORT.md                   # Отчёт по результатам работы
└── README.md                   # Это описание
```

# Тестирование

Тесты находятся в директории tests/.
Для запуска:
```
make test
```
Поддерживается:

- unit-тесты
- fixtures
- Автоматическое покрытие (coverage)
- Линтинг и форматирование

# Зависимости


# Линтер

Для проверки соответствия PEP8 и форматирования:

```
make lint
```

Используются:

- flake8 — проверка стиля
- black — форматирование
- ruff — быстрая замена flake8 + автоисправления


# Форматирование кода

Чтобы отформатировать весь код:
```
make fmt
```

# Документирование

Проект документируется в соответствии со стандартами Numpy (numpydoc).

Документирование включает:

- Описание модулей и классов
- Аргументы функций и возвращаемые значения
- Примеры использования

Пример оформления docstring:
```
def analyze_data(df):
    """
    Анализирует данные и возвращает статистику.

    Parameters
    ----------
    df : pd.DataFrame
        Входной датафрейм с данными о фрилансерах

    Returns
    -------
    dict
        Результаты анализа: среднее, медиана, количество и т.д.
    """
```

# Makefile

Удобство управления проектом обеспечивается через Makefile.

Доступные цели:

| Цель | Описание |
|----------|------------|
| help | Вывод всех доступных целей |
|  install | Установка зависимостей |
| lint | Проверка стиля |
| fmt  | Форматирование кода |
| test | Запуск юнит-тестов |
| docs | Генерация документации (Sphinx) |

# Docker

Проект можно запустить в контейнере:

Сборка образа
```
docker build -t llm_data_console .
```

Запуск:
```
docker run -it --rm -v $(pwd):/workspace -w /workspace llm_data_console python3 app/main.py
```

# Используемые переменные окружения


| Переменная | Описание |
|----------|------------|
|  PATH_TO_DATA | Путь до набора данных |
| PATH_TO_PROMPT_CONFIG | Путь до файла с промптом |
| MODEL_NAME  | Название модели |
| USE_OPENAI | True если использовать LLM от OpenAI |
| HTTP_PROXY | http прокси если необходимо (можно оставить пустыми) |
| HTTPS_PROXY | https прокси если необходимо (можно оставить пустыми) |
| OPENAI_API_KEY | API ключ openai |