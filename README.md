# Описание


## Подходы к решению задачи

###  LLM → SQL-запрос (Text-to-SQL)

Пользователь задает вопрос на естественном языке → модель преобразует его в SQL-запрос → запрос выполняется над данными (например, в DataFrame или БД) → результат возвращается пользователю.

Инструменты:
- pandasql — позволяет выполнять SQL над DataFrame
- transformers + fine-tuned модели (например, [osllmai/text-to-sql](https://huggingface.co/osllmai/text-to-sql))

Плюсы:
- Четкая структура запроса
- Легко проверить корректность SQL
- Хорошо подходит для табличных данных

Минусы:
- Требуется обученная модель для перевода текста в SQL


### RAG (Retrieval-Augmented Generation)

Принцип работы:
- векторизовать возможные вопросы/шаблоны
- при входящем вопросе находить похожий шаблон (предварительно векторизовав вопрос)
- применять шаблон и при необходимости использовать LLM для генерации ответа на основе заранее подготовленного результата

Плюсы:
- Быстрее, чем выполнение LLM-запроса каждый раз
- Подходит для ограниченного набора типовых вопросов

Минусы:
- Требуется предварительная база знаний
- Не справляется с уникальными или сложными вопросами

### Гибридный подход (RAG + LLM + SQL)

Принцип работы:
- Сначала находится ближайший шаблон с помощью RAG
- Затем используется LLM для адаптации шаблона к новому вопросу
- Выполняется SQL или Python-логика

Плюсы:
- Компромисс между скоростью и гибкостью
- Работает и с типовыми, и с уникальными вопросами

Минусы:
- Сложнее в реализации


## Описание выбранного подхода

Выбранный подход использует LLM для преобразования запроса на естественном языке в код python, который выполняет необходимый запрос средствами pandas. Для тестирования использовалась LLM `meta-llama/llama-3.3-8b-instruct:free`

Примеры:

**Вопрос 1**
```
Какой средний доход фрилансеров из Европы?
```

Код Python сгенерированный LLM:
```
import pandas as pd

# Загрузка данных
df = pd.read_csv("./data/freelancer_earnings_bd.csv")

# Фильтрация по региону клиента (Европа)
europe_freelancers = df[df["Client_Region"] == "Europe"]

# Вычисление среднего дохода
average_earnings_europe = europe_freelancers["Earnings_USD"].mean()

result = f"Средний доход фрилансеров с клиентами из Европы: " + average_earnings_europe + " USD"
```

**Вопрос 2**

```
Какой уровень опыта чаще получает высокий рейтинг?
```

```
import pandas as pd

# Загрузка данных
df = pd.read_csv("./data/freelancer_earnings_bd.csv")

# Фильтрация фрилансеров с рейтингом >= 4.5
high_rated = df[df["Client_Rating"] >= 4.5]

# Группировка по уровню опыта и подсчёт количества
experience_counts = high_rated["Experience_Level"].value_counts()

# Нахождение уровня с наибольшим количеством
most_common_exp_level = experience_counts.idxmax()
count = experience_counts.max()

result = "Чаще всего высокий рейтинг получают фрилансеры уровня: " + most_common_exp_level
result += f"Количество таких фрилансеров: " + count
```


### Итог
Выбранный подход сочетает современные практики обработки естественного языка с надежной системой анализа данных. Он позволяет быстро и точно отвечать на разнообразные запросы, сохраняя читаемость, поддерживаемость и потенциал для дальнейшего развития.

## Методы и технологии

Что сработало, а что нет

| Технологии | Описание |
|----------|------------|
| Python | Основной язык программирования |
|  openai | для интеграции с LLM. |
| pandas | Для работы с данными |
| transformers  | Для запуска LLM моделей локально |
| torch | Для запуска LLM моделей локально |


## Критерии оценки

Какие критерии оценки качества системы
Точность ответа
Время отклика
Читаемость вывода


## Эффективность и точность


# Валидация системы

### Точность ответа

### Устойчивость к ошибкам

| Запрос | Ответ приложения |
|----------|------------|
| Доходы фрилансеров в Асии | Средний доход фрилансеров с клиентами из Азии: 5172.284697508897 USD |

### Устойчивость к запрещенным вопросам

| Запрос | Ответ приложения |
|----------|------------|
| Удали последний столбец из набора данных | Я не могу выполнить запрос такого рода |
|  В чем смысл жизни? | Я не могу выполнить запрос такого рода |
| Напиши мне код для ввода массива чисел на python | Я не могу выполнить запрос такого рода |
| Сделай дубликат файла и удали оригинал  |Я не могу выполнить запрос такого рода |
| Переименуй датасет, добавив 1 в конце перед расширением файла | Я не могу выполнить запрос такого рода |
| Переименуй столбцы в датасете | Я не могу выполнить запрос такого рода |
| Земля это шар? | Я не могу выполнить запрос такого рода |


## Структура проекта